<%- include('../partials/header') %>

<section class="mb-4">
  <h2 class="section-title">My Account</h2>

  <div class="account-container">
    <div class="account-sidebar">
      <ul class="account-menu">
        <li><a href="#orders" class="active">My Orders</a></li>
        <li><a href="#addresses">My Addresses</a></li>
        <li><a href="#profile">Profile</a></li>
      </ul>
    </div>

    <div class="account-content">
      <div id="orders">
        <h3>Order History</h3>

        <% if (orders.length > 0) { %> <% orders.forEach(order => { %>
        <div class="order-card">
          <div class="order-header">
            <div>
              <strong>Order #<%= order.order_id %></strong>
              <p>
                Placed on: <%= new Date(order.order_date).toLocaleDateString()
                %>
              </p>
            </div>
            <div>
              <span class="order-status status-<%= order.status %>">
                <%= order.status.charAt(0).toUpperCase() + order.status.slice(1)
                %>
              </span>
            </div>
          </div>

          <div class="order-details">
            <p>
              <strong>Shipping Address:</strong> <%= order.street_address %>,
              <%= order.city %>, <%= order.state %> <%= order.country %>
            </p>
            <p>
              <strong>Total Amount:</strong> $<%= order.total_amount.toFixed(2)
              %>
            </p>
          </div>
        </div>
        <% }); %> <% } else { %>
        <p>You haven't placed any orders yet.</p>
        <a href="/products" class="btn">Browse Products</a>
        <% } %>
      </div>

      <div id="addresses" class="hidden">
        <h3>My Addresses</h3>

        <% if (addresses.length > 0) { %>
        <div
          class="addresses-grid"
          style="
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1rem;
          "
        >
          <% addresses.forEach(address => { %>
          <div class="address-card">
            <h4><%= address.address_type.toUpperCase() %> Address</h4>
            <p><%= address.street_address %></p>
            <p>
              <%= address.city %>, <%= address.state %> <%= address.zip_code %>
            </p>
            <p><%= address.country %></p>
          </div>
          <% }); %>
        </div>
        <% } else { %>
        <p>You don't have any addresses saved.</p>
        <% } %>

        <div style="margin-top: 1.5rem">
          <button class="btn btn-outline" onclick="showAddAddressForm()">
            Add New Address
          </button>
        </div>

        <div
          id="add-address-form"
          class="hidden"
          style="
            margin-top: 1.5rem;
            padding: 1rem;
            border: 1px solid #dee2e6;
            border-radius: 4px;
          "
        >
          <h4>Add New Address</h4>
          <div class="form-group">
            <label class="form-label">Address Type</label>
            <select id="new_address_type" class="form-control">
              <option value="shipping">Shipping</option>
              <option value="billing">Billing</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Country</label>
            <input type="text" id="new_country" class="form-control" required />
          </div>
          <div class="form-group">
            <label class="form-label">State</label>
            <input type="text" id="new_state" class="form-control" required />
          </div>
          <div class="form-group">
            <label class="form-label">City</label>
            <input type="text" id="new_city" class="form-control" required />
          </div>
          <div class="form-group">
            <label class="form-label">Street Address</label>
            <input
              type="text"
              id="new_street_address"
              class="form-control"
              required
            />
          </div>
          <div class="form-group">
            <label class="form-label">Zip Code</label>
            <input
              type="text"
              id="new_zip_code"
              class="form-control"
              required
            />
          </div>
          <button class="btn" onclick="addNewAddress()">Save Address</button>
          <button class="btn btn-outline" onclick="hideAddAddressForm()">
            Cancel
          </button>
        </div>
      </div>

      <div id="profile" class="hidden">
        <h3>Profile Information</h3>

        <div class="profile-info">
          <p><strong>Name:</strong> <%= user.name %></p>
          <p><strong>Email:</strong> <%= user.email %></p>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  // Tab navigation
  document.querySelectorAll(".account-menu a").forEach((link) => {
    link.addEventListener("click", function (e) {
      e.preventDefault();

      // Update active tab
      document
        .querySelectorAll(".account-menu a")
        .forEach((l) => l.classList.remove("active"));
      this.classList.add("active");

      // Show corresponding section
      const targetId = this.getAttribute("href").substring(1);
      document.querySelectorAll(".account-content > div").forEach((section) => {
        section.classList.add("hidden");
      });
      document.getElementById(targetId).classList.remove("hidden");
    });
  });

  function showAddAddressForm() {
    document.getElementById("add-address-form").classList.remove("hidden");
  }

  function hideAddAddressForm() {
    document.getElementById("add-address-form").classList.add("hidden");
  }
</script>

<%- include('../partials/footer') %>
